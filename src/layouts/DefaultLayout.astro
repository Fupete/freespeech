---
import "../lib/app.css";
import StoreManager from "../components/StoreManager.svelte";
import pc from "../lib/prisma";
const { title } = Astro.props;
let user = null;
const cookie = Astro.request.headers.get("cookie");
const token = await pc.accessToken.findUnique({
  where: {
    token: cookie?.split("=")[1] + "",
  },
});
if (token) {
  // give this to the client
  user = await pc.user.findUnique({
    where: {
      id: token.userId,
    },
    include: {
      projects: true,
    },
  });
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- <meta name="viewport" content="width=device-width, initial-scale=0.85" /> -->
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1.0,maximum-scale=1.0"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200"
    />

    <title>{title}</title>
  </head>
  <body class="text-slate-50">
    <slot />
    <StoreManager client:load _Me={user} />
  </body>
</html>
